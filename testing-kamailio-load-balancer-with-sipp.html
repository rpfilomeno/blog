<!DOCTYPE html><html lang="en-us"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Testing Kamailio load balancer with SIPp - Ai.2.mations</title><meta name="description" content="Here are the steps to test Kamailio under load. First of all lets describe our network setup: The a user from extension 300X registered to Asterisk 1 initiates a call to an extension 400X registered at Asterisk 2. Kamailio is registered as a trunk to&hellip;"><meta name="generator" content="Publii Open-Source CMS for Static Site"><script type="text/javascript" async src="https://www.googletagmanager.com/gtag/js?id=G-VLXN0Y9Q0W"></script><script type="text/javascript">window.dataLayer = window.dataLayer || [];
				  function gtag(){dataLayer.push(arguments);}
				  gtag('js', new Date());
				  gtag('config', 'G-VLXN0Y9Q0W' );</script><link rel="canonical" href="https://roger.rogverse.fyi/testing-kamailio-load-balancer-with-sipp.html"><link rel="alternate" type="application/atom+xml" href="https://roger.rogverse.fyi/feed.xml"><link rel="alternate" type="application/json" href="https://roger.rogverse.fyi/feed.json"><meta property="og:title" content="Testing Kamailio load balancer with SIPp"><meta property="og:image" content="https://roger.rogverse.fyi/media/posts/2/5348744.png"><meta property="og:image:width" content="200"><meta property="og:image:height" content="200"><meta property="og:site_name" content="Ai.2.mations"><meta property="og:description" content="Here are the steps to test Kamailio under load. First of all lets describe our network setup: The a user from extension 300X registered to Asterisk 1 initiates a call to an extension 400X registered at Asterisk 2. Kamailio is registered as a trunk to&hellip;"><meta property="og:url" content="https://roger.rogverse.fyi/testing-kamailio-load-balancer-with-sipp.html"><meta property="og:type" content="article"><meta name="twitter:card" content="summary_large_image"><meta name="twitter:site" content="@godie"><meta name="twitter:title" content="Testing Kamailio load balancer with SIPp"><meta name="twitter:description" content="Here are the steps to test Kamailio under load. First of all lets describe our network setup: The a user from extension 300X registered to Asterisk 1 initiates a call to an extension 400X registered at Asterisk 2. Kamailio is registered as a trunk to&hellip;"><meta name="twitter:image" content="https://roger.rogverse.fyi/media/posts/2/5348744.png"><link rel="stylesheet" href="https://roger.rogverse.fyi/assets/css/style.css?v=2d788153c912d3afda77a06fe119f1e4"><script type="application/ld+json">{"@context":"http://schema.org","@type":"Article","mainEntityOfPage":{"@type":"WebPage","@id":"https://roger.rogverse.fyi/testing-kamailio-load-balancer-with-sipp.html"},"headline":"Testing Kamailio load balancer with SIPp","datePublished":"2025-03-22T22:11","dateModified":"2025-03-22T23:18","image":{"@type":"ImageObject","url":"https://roger.rogverse.fyi/media/posts/2/5348744.png","height":200,"width":200},"description":"Here are the steps to test Kamailio under load. First of all lets describe our network setup: The a user from extension 300X registered to Asterisk 1 initiates a call to an extension 400X registered at Asterisk 2. Kamailio is registered as a trunk to&hellip;","author":{"@type":"Person","name":"Roger Filomeno","url":"https://roger.rogverse.fyi/authors/roger-filomeno/"},"publisher":{"@type":"Organization","name":"Roger Filomeno"}}</script><noscript><style>img[loading] {
                    opacity: 1;
                }</style></noscript><script src="https://cdn.botpress.cloud/webchat/v2.2/inject.js"></script><script src="https://files.bpcontent.cloud/2025/01/25/00/20250125005609-7G1UEWJF.js"></script></head><body class="post-template"><div class="container js-container"><nav class="menu"><ul class="navbar__menu"><li><a href="https://roger.rogverse.fyi/" title="Home" target="_self">Home</a></li><li><a href="https://roger.rogverse.fyi/work.html" title="Work" target="_self">Work</a></li><li><a href="https://roger.rogverse.fyi/3d-projects-2.html" target="_self">3D Projects</a></li><li><a href="https://roger.rogverse.fyi/tags/" title="tags" target="_self">Tags</a></li><li><a href="https://roger.rogverse.fyi/tags/blog/" title="log" target="_self">Blog</a></li></ul></nav><div class="container__content"><header class="top"><div class="top__item"><a class="logo" href="https://roger.rogverse.fyi/">Ai.2.mations</a></div><div class="top__item top__item--right"><button class="menu-toggle js-menu-toggle" aria-label="Menu" aria-expanded="false"><span class="menu-toggle-box"><span class="menu-toggle-inner">Menu</span></span></button></div></header><main class="main post"><article class="content"><div class="main__left"><figure class="hero"><img src="https://roger.rogverse.fyi/media/posts/2/5348744.png" srcset="https://roger.rogverse.fyi/media/posts/2/responsive/5348744-xs.webp 300w, https://roger.rogverse.fyi/media/posts/2/responsive/5348744-sm.webp 480w, https://roger.rogverse.fyi/media/posts/2/responsive/5348744-md.webp 768w, https://roger.rogverse.fyi/media/posts/2/responsive/5348744-lg.webp 1024w, https://roger.rogverse.fyi/media/posts/2/responsive/5348744-xl.webp 1280w, https://roger.rogverse.fyi/media/posts/2/responsive/5348744-2xl.webp 1600w" sizes="(min-width: 1800px) 50vw, (min-width: 900px) 40vw, 100vw" loading="eager" height="200" width="200" alt=""></figure><header><h1>Testing Kamailio load balancer with SIPp</h1><p><time datetime="2025-03-22T22:11">March 22, 2025 </time>by <a href="https://roger.rogverse.fyi/authors/roger-filomeno/" rel="author" title="Roger Filomeno">Roger Filomeno</a></p></header></div><div class="main__right"><div class="content__entry"><p>Here are the steps to test Kamailio under load.</p><p>First of all lets describe our network setup:</p><script src="https://gist.github.com/rpfilomeno/d46493eefaf70d6838c157305ab9778a.js"></script><p>The a user from extension <em>300X</em> registered to <em>Asterisk 1</em> initiates a call to an extension <em>400X</em> registered at <em>Asterisk 2</em>. <em>Kamailio</em> is registered as a <em>trunk</em> to both Asterisk 1 &amp; 2; which intercepts the call which load balances it to either <em>Asterisk X or Y</em> where they do some <em>fancy</em> pre-processing to current call before its received by the callee.</p><p>Now for our testing purposes, we needed to remove the effect on performance by Asterisk 1 &amp; 2 so we installed SIPp on another host which generates calls and receives them.</p><h3 id="installation-and-execution-steps">Installation and Execution Steps</h3><ol><li>Download and Modify SIPp to auto respond always and include OPTIONS packet as well (-aa broken?), edit src/call.cpp:</li></ol><pre><code class="language-cpp">call::T_AutoMode call::checkAutomaticResponseMode(char * P_recv)
{
    if (strcmp(P_recv, &quot;BYE&quot;)==0) {
        return E_AM_UNEXP_BYE;
    } else if (strcmp(P_recv, &quot;CANCEL&quot;) == 0) {
        return E_AM_UNEXP_CANCEL;
    } else if (strcmp(P_recv, &quot;PING&quot;) == 0) {
        return E_AM_PING;
    } else if ((strcmp(P_recv, &quot;INFO&quot;) == 0) || (strcmp(P_recv, &quot;NOTIFY&quot;) == 0) || (strcmp(P_recv, &quot;UPDATE&quot;) == 0) || (strcmp(P_recv, &quot;OPTIONS&quot;) == 0)
               ) {
        return E_AM_AA;
    } else {
        return E_AM_DEFAULT;
    }
}
</code></pre><p>Compile <em>sipp-3.3.990</em> with <a href="http://sipp.sourceforge.net/doc/reference.html#Installing+SIPp">RTP Support</a>.</p><p>To run the test, from SIPp Box:</p><pre><code class="language-bash"># sipp 10.254.1.30 -i 10.254.1.40 -sf uac.xml -aa -inf accounts.csv -l 10000 -r 1 -rp 1000 -trace_msg -trace_err -trace_stat
</code></pre><table class="table"><thead><tr><th>Parameter</th><th>Description</th></tr></thead><tbody><tr><td>10.254.1.30</td><td>target Kamailio's IP on the LAN A side (see network diagram)</td></tr><tr><td>-i 10.254.1.40</td><td>make sure to bind SIPp on this IP especially if we are using IP Authentication on Kamailio</td></tr><tr><td>-sf <a href="https://gist.github.com/rpfilomeno/7445a628a3cbc0ceaaf8e9afe182578b#file-uac-xml">uac.xml</a></td><td>use this scenario file that generates calls.</td></tr><tr><td>-inf <a href="https://gist.github.com/rpfilomeno/8673ee9dc7355274dfd98d187bbde925#file-accounts-csv">accounts.csv</a></td><td>use this input CSV file, this is where the <em>[field0]</em>,<em>[field1]</em>,<em>[field2]</em> and <em>[field3]</em> values are derived in uac.xml.<br>Edit this file accordingly in format: <em>CallID;Kamailio LAN A IP;[authentication];Extension on Asterisk 2;Asterisk 2 LAN B IP;</em></td></tr><tr><td>-l 10000</td><td>run 1000 calls.</td></tr><tr><td>-r 1 -rp 1000</td><td>make one call per 1000ms (1 secs)</td></tr><tr><td>-trace_msg</td><td>log all messages to a file (filename auto generated)</td></tr><tr><td>-trace_err</td><td>log all errors to a separate file (filename auto generated)</td></tr><tr><td>-trace_stat</td><td>generate a CSV file with statistics which is good for making graphs (default 1 minute interval)</td></tr></tbody></table><p>Make sure to edit the accounts.csv, change 10.254.1.30 and 10.254.7.31 accordingly.</p><p>Make sure to edit the uac.xml, change Route:</p><pre><code>&lt;sip:10.254.1.30;r2=on;lr=on;nat=yes&gt;,&lt;sip:10.254.3.30;r2=on;lr=on;nat=yes&gt;```
accordingly since sipp-3.3.990 can&#39;t reliably generate this header so we had to hard code this for now. 

You may run a SIPp on Asterisk 2 box to test higher concurrent calls (eg: testing more than 200 concurrent calls).

Lets shutdown Asterisk 1 &amp; 2: 
```bash
# asterisk -rx &quot;core stop now&quot;
</code></pre><p>To run a server listening to incoming calls (server mode), run:</p><pre><code class="language-bash"># sipp 10.254.7.30 -i 10.254.7.31 -sf uas.xml -aa -trace_msg -trace_err -trace_stat
</code></pre><p>Makes sure to edit the <a href="https://gist.github.com/rpfilomeno/5827e6ecf5863f74f53d41b1e15fa707#file-uas-xml">uas.xml</a> to include the IP routes.</p><p>Now lets see how effective is Kamailio in this setup, here are the results I had:</p><table class="table"><thead><tr><th>Test Name</th><th>Concurrent Calls</th><th>Success</th><th>Failed</th><th>Dead Calls</th><th>Retransmissions</th><th>Average Response Time</th><th>Average Call Rate Per Seconds</th></tr></thead><tbody><tr><td>Test1</td><td>200</td><td>1000</td><td>0</td><td>0</td><td>3</td><td>2.52747</td><td>03.615000</td></tr><tr><td>Test2</td><td>300</td><td>998</td><td>2</td><td>5</td><td>252</td><td>3.15839</td><td>04.550000</td></tr><tr><td>Test3</td><td>400</td><td>993</td><td>7</td><td>12</td><td>1355</td><td>3.61512</td><td>13.049000</td></tr><tr><td>Test4</td><td>600</td><td>831</td><td>169</td><td>127</td><td>3554</td><td>4.05337</td><td>13.04900</td></tr></tbody></table><p>We stop at <em>Test 4</em> seeing Failed Calls spiked up at 169 calls, this was significant from our base capacity of 50 concurrent calls already.</p><p>Many thanks to <a href="http://saevolgo.blogspot.com/">Gohar Ahmed</a> for helping me figuring most of the bugs.</p><footer><div class="content__tag-share"><ul class="content__tag"><li><a href="https://roger.rogverse.fyi/tags/blog/">Blog</a></li><li><a href="https://roger.rogverse.fyi/tags/testing/">Testing</a></li><li><a href="https://roger.rogverse.fyi/tags/voip/">VOIP</a></li></ul><div class="content__share"><a href="https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Froger.rogverse.fyi%2Ftesting-kamailio-load-balancer-with-sipp.html" class="js-share facebook" aria-label="Share with Facebook" rel="nofollow noopener noreferrer"><svg class="icon"><use xlink:href="https://roger.rogverse.fyi/assets/svg/svg-map.svg#facebook"/></svg> </a><a href="https://twitter.com/intent/tweet?url=https%3A%2F%2Froger.rogverse.fyi%2Ftesting-kamailio-load-balancer-with-sipp.html&amp;via=godieph&amp;text=Testing%20Kamailio%20load%20balancer%20with%20SIPp" class="js-share twitter" aria-label="Share with Twitter" rel="nofollow noopener noreferrer"><svg class="icon"><use xlink:href="https://roger.rogverse.fyi/assets/svg/svg-map.svg#twitter"/></svg> </a><a href="https://pinterest.com/pin/create/button/?url=https%3A%2F%2Froger.rogverse.fyi%2Ftesting-kamailio-load-balancer-with-sipp.html&amp;media=https%3A%2F%2Froger.rogverse.fyi%2Fmedia%2Fposts%2F2%2F5348744.png&amp;description=Testing%20Kamailio%20load%20balancer%20with%20SIPp" class="js-share pinterest" aria-label="Share with Pinterest" rel="nofollow noopener noreferrer"><svg class="icon"><use xlink:href="https://roger.rogverse.fyi/assets/svg/svg-map.svg#pinterest"/></svg> </a><a href="https://www.linkedin.com/sharing/share-offsite/?url=https%3A%2F%2Froger.rogverse.fyi%2Ftesting-kamailio-load-balancer-with-sipp.html" class="js-share linkedin" aria-label="Share with LinkedIn" rel="nofollow noopener noreferrer"><svg class="icon"><use xlink:href="https://roger.rogverse.fyi/assets/svg/svg-map.svg#linkedin"/></svg></a></div></div><div class="content__bio"><img src="https://roger.rogverse.fyi/media/website/circle-avatar-open.png" loading="lazy" height="1080" width="1080" alt="Roger Filomeno"><h3><a href="https://roger.rogverse.fyi/authors/roger-filomeno/" title="Roger Filomeno">Roger Filomeno</a></h3><div class="content__bio-desc"><p>Roger the CEO of <a href="https://rogverse.fyi/" title="Automation that Amplifies Human Potential" target="_blank" rel="noopener">ROGVERSE</a> ltd -- a comprehensive AI automation platform built on principle: <em>Automation that Amplifies Human Potential</em></p></div></div></footer></div></div></article><div class="main__right main__right--bottom"><div class="related"><h2 class="related__title">Related posts:</h2><ul class="related__items"><li class="related__item"><h3 class="h5"><a href="https://roger.rogverse.fyi/monitoring-kamailio-and-asterisk-with-aws-cloudwatch.html">Monitoring Kamailio and Asterisk with AWS CloudWatch</a></h3><time datetime="2025-03-22T22:42" class="feed__meta">March 22, 2025</time></li></ul></div></div></main><footer class="footer"><div class="footer__social"><a href="https://web.facebook.com/ilovejelatin" class="facebook" aria-label="Facebook"><svg class="icon"><use xlink:href="https://roger.rogverse.fyi/assets/svg/svg-map.svg#facebook"/></svg> </a><a href="https://x.com/godie" class="twitter" aria-label="Twitter"><svg class="icon"><use xlink:href="https://roger.rogverse.fyi/assets/svg/svg-map.svg#twitter"/></svg> </a><a href="https://www.linkedin.com/in/rpfilomeno/" class="linkedin" aria-label="LinkedIn"><svg class="icon"><use xlink:href="https://roger.rogverse.fyi/assets/svg/svg-map.svg#linkedin"/></svg> </a><a href="https://www.youtube.com/@godiegaming" class="youtube" aria-label="Youtube"><svg class="icon"><use xlink:href="https://roger.rogverse.fyi/assets/svg/svg-map.svg#youtube"/></svg></a></div><div class="footer__copyright">A.I.2.mations 2025 All rights reserved</div></footer></div></div><script defer="defer" src="https://roger.rogverse.fyi/assets/js/scripts.min.js?v=1ea8317abae2e05fa2a65ed7bbff7ba7"></script><script>var images = document.querySelectorAll('img[loading]');
   
           for (var i = 0; i < images.length; i++) {
               if (images[i].complete) {
                   images[i].classList.add('is-loaded');
               } else {
                   images[i].addEventListener('load', function () {
                       this.classList.add('is-loaded');
                   }, false);
               }
           }</script><script src="https://roger.rogverse.fyi/media/plugins/pagePrefetching/quicklink.umd.js"></script><script>window.addEventListener('load', () => {
   					quicklink.listen({
   						prerender: true,
   						el: document.querySelector('body'),
   						delay: 0,
   						limit: Infinity,
   						throttle: Infinity,
   						timeout: 2000
   					});
   				});</script></body></html>